/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_merge","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/fl/initial/_internal/storageResultDisassemble","sap/ui/fl/initial/_internal/StorageFeaturesMerger","sap/ui/fl/initial/_internal/StorageResultMerger","sap/ui/fl/initial/_internal/StorageUtils","sap/ui/fl/Layer"],function(e,r,t,n,a,o,i){"use strict";function s(e,t){var n=t.map(function(t){var n=Object.assign({},e,{url:t.url,path:t.path});var a=r.getByReference(e.reference);if(!t.layers||t.layers[0]!=="ALL"&&t.layers.indexOf(i.CUSTOMER)===-1){delete n.version}else{if(a.initialAllContexts){n.allContexts=true}if(!n.version&&a.version){n.version=a.version}}var s=!!window.sessionStorage.getItem(`sap.ui.rta.restart.${i.CUSTOMER}`);if(!s&&!a.saveChangeKeepSession){delete a.version;delete a.maxLayer;delete a.adaptationLayer;r.setByReference(a,e.reference)}return t.loadConnectorModule.loadFlexData(n).then(function(e){return e||o.getEmptyFlexDataResponse()}).catch(o.logAndResolveDefault.bind(undefined,o.getEmptyFlexDataResponse(),t,"loadFlexData"))});return Promise.all(n)}function l(e){var r=[];e.forEach(function(e){if(Array.isArray(e)){r=r.concat(e)}else{r.push(e)}});return r}function u(e){return e.map(function(e){return t(e)})}function c(e){return Promise.resolve(e).then(l).then(u).then(l).then(a.merge)}function f(e){return o.getStaticFileConnector().then(s.bind(this,e))}function d(e){var r=e.map(function(e){if(!e?.loadConnectorModule?.loadFeatures){return Promise.resolve(o.logAndResolveDefault({features:{},layers:e.layers},e,"loadFeatures"))}return e.loadConnectorModule.loadFeatures({url:e.url}).then(function(r){return{features:r,layers:e.layers}}).catch(o.logAndResolveDefault.bind(null,{features:{},layers:e.layers},e,"loadFeatures"))});return Promise.all(r)}async function h(r,t){const n=await Promise.all(t.map(function(e){const t=Object.assign({reference:r},{url:e.url});return e.loadConnectorModule.loadVariantsAuthors(t).then(e=>e||{}).catch(o.logAndResolveDefault.bind(undefined,{},e,"loadVariantsAuthors"))}));return e({},...n)}var p={};p.loadFeatures=function(){return o.getLoadConnectors().then(d).then(n.mergeResults)};p.completeFlexData=function(e){if(!e||!e.reference){return Promise.reject("No reference was provided")}return Promise.all([f(e),e.partialFlexData]).then(c)};p.loadFlexData=function(e){if(!e||!e.reference){return Promise.reject("No reference was provided")}return o.getLoadConnectors().then(s.bind(this,e)).then(c)};p.loadVariantsAuthors=function(e){if(!e){return Promise.reject("No reference was provided")}return o.getLoadConnectors().then(h.bind(this,e))};return p});
//# sourceMappingURL=Storage.js.map