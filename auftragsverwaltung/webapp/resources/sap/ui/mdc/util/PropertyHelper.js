/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/base/DataType","sap/base/util/merge","sap/base/util/isPlainObject","sap/base/Log","sap/ui/core/Lib"],(e,t,r,o,i,n)=>{"use strict";const a={key:{type:"string",mandatory:true,inComplexProperty:{allowed:true}},label:{type:"string",mandatory:true,inComplexProperty:{allowed:true}},tooltip:{type:"string",inComplexProperty:{allowed:true}},visible:{type:"boolean",default:{value:true},inComplexProperty:{allowed:true}},path:{type:"string"},dataType:{type:"string",mandatory:true},formatOptions:{type:"object"},constraints:{type:"object"},maxConditions:{type:"int",default:{value:-1}},caseSensitive:{type:"boolean",default:{value:true}},group:{type:"string",inComplexProperty:{allowed:true}},groupLabel:{type:"string",inComplexProperty:{allowed:true}},filterable:{type:"boolean",default:{value:true},inComplexProperty:{valueIfNotAllowed:false}},sortable:{type:"boolean",default:{value:true},inComplexProperty:{valueIfNotAllowed:false}},propertyInfos:{type:"PropertyReference[]",inComplexProperty:{allowed:true}}};const p={key:"name"};const l={isComplex:function(){return I.isPropertyComplex(this)},getSimpleProperties:function(){return this.propertyInfosProperties||[this]},getSortableProperties:function(){return this.getSimpleProperties().filter(e=>e.sortable)},getFilterableProperties:function(){return this.getSimpleProperties().filter(e=>e.filterable)},getVisibleProperties:function(){return this.getSimpleProperties().filter(e=>e.visible)}};const s=["key","label","tooltip","visible","path","dataType","formatOptions","constraints","maxConditions","group","groupLabel","caseSensitive"];const u=new WeakMap;function f(e){return JSON.stringify(e,(e,t)=>t===undefined?null:t)||""}function c(e,t){const r=n.all();if(!(window["sap-ui-mdc-config"]&&window["sap-ui-mdc-config"].disableStrictPropertyInfoValidation||new URLSearchParams(window.location.search).get("sap-ui-xx-disableStrictPropertyValidation")=="true")&&!("sap.fe.core"in r||"sap.fe.macros"in r||"sap.sac.df"in r)||new URLSearchParams(window.location.search).get("sap-ui-xx-enableStrictPropertyValidation")=="true"){y(e,t)}if(i.getLevel()<i.WARNING){return}const o=f(t);i.warning("Invalid property definition: "+e+(o?"\n"+o:""))}function y(e,t){const r=t?f(t):null;throw new Error("Invalid property definition: "+e+(r?"\n"+r:""))}function d(e,t){t.map(e=>{Object.keys(l).forEach(t=>{Object.defineProperty(e,t,{value:function(){return l[t].call(this)},writable:true})})})}function P(e){const t=Object.getOwnPropertyNames(e);Object.freeze(e);for(let r=0;r<t.length;r++){const i=e[t[r]];if(typeof i==="function"){Object.freeze(i)}else if(o(i)&&!Object.isFrozen(i)){P(i)}else if(Array.isArray(i)){P(i)}}}function b(e,t){if(!t){return e}return t.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,e)}function g(e){let r;if(typeof e==="object"){r="object"}else{r=e.replace("PropertyReference","string")}return t.getType(r)}function m(e){const t=g(e);if(t.isArrayType()){return t.getBaseType().getDefaultValue()}else{return t.getDefaultValue()}}function h(e,t){t.forEach(t=>{e.prepareProperty(t)});P(t)}function v(e,t,r,o,i,n){const a=o==null;let p=[];const l=I.isPropertyComplex(t);if(a){n=u.get(e).mAttributeMetadata;i=t}if(!i){return[]}for(const s in n){const u=n[s];const f=a?s:o+"."+s;const c=i[s];if(l&&!u.inComplexProperty.allowed){if("valueIfNotAllowed"in u.inComplexProperty){i[s]=u.inComplexProperty.valueIfNotAllowed}continue}if(c!=null&&typeof u.type==="string"&&u.type.startsWith("PropertyReference")||f==="propertyInfos"){if(l||f!=="propertyInfos"){w(i,s,r)}continue}if(c==null){x(i,u,o,s,p,c)}if(typeof u.type==="object"){p=p.concat(v(e,t,r,f,i[s],u.type))}}return p}function w(e,t,r){const o=e[t];let i;let n=t;if(Array.isArray(o)){i=o.map(e=>r[e]);n+="Properties"}else{i=r[o];n+="Property"}Object.defineProperty(e,n,{value:i})}function x(e,t,o,i,n,a){const p=t.default;if(p.ignoreIfNull&&a===null){return}if(typeof p.value==="string"&&p.value.startsWith("attribute:")){n.push({source:p.value.substring(p.value.indexOf(":")+1),targetPath:o,targetAttribute:i,targetType:t.type})}else if(Array.isArray(p.value)){e[i]=r([],p.value)}else if(typeof p.value==="object"&&p.value!==null){e[i]=r({},p.value)}else{e[i]=p.value}}function C(e){return Object.freeze(e.reduce((e,t)=>{e[t.key]=t;return e},{}))}function A(e,t){for(const r in e){const o=e[r];const i=!t;o.mandatory=o.mandatory===true&&i;o.default={...o.default};o.default.value=o.default.value??m(o.type);o.inComplexProperty={...o.inComplexProperty};if(o.inComplexProperty.allowed===true){o.inComplexProperty.allowed=i||t.inComplexProperty.allowed===true}else if(!("allowed"in o.inComplexProperty)){const e=t?.inComplexProperty.allowed===true&&t?.inComplexProperty.propagateAllowance!==false;o.inComplexProperty.allowed=e}if(typeof o.type==="object"){A(o.type,o)}delete o.inComplexProperty.propagateAllowance}}function j(e,t){if(!Array.isArray(t)){y("Property infos must be an array.")}const o=u.get(e);const i=r([],t);e.validateProperties(i,o.aPreviousRawProperties);const n=O(i);o.aProperties=n;o.mProperties=C(n);o.aPreviousRawProperties=r([],t);d(e,n);h(e,n)}function O(e){const t=Object.entries(p);return e.map(e=>{const r={...e};t.forEach(([t,o])=>{if(t in e&&o in e&&e[t]!==e[o]){y(`The values of legacy-attribute '${o}' and it's replacement '${t}' must be identical.`,e)}if(!(t in e)&&o in e){r[t]=e[o]}if(!(o in e)&&t in e){r[o]=e[t]}});return r})}function M(e){return e.key||p["key"]&&e[p["key"]]}const I=e.extend("sap.ui.mdc.util.PropertyHelper",{constructor:function(t,r,o){e.call(this);if(r&&!e.isObjectA(r,"sap.ui.base.ManagedObject")){throw new Error("The type of the parent is invalid.")}Object.keys(o||{}).forEach(e=>{if(e in a&&o[e]!==true){throw new Error("The attribute '"+e+"' is reserved and cannot be overridden by additional attributes.")}});const i={};const n=Object.keys(o||{});i.mAttributeMetadata=s.concat(n).reduce((e,t)=>{e[t]=t in a?a[t]:o[t];return e},{});A(i.mAttributeMetadata);i.aMandatoryAttributes=Object.keys(i.mAttributeMetadata).filter(e=>i.mAttributeMetadata[e].mandatory);i.oParent=r||null;u.set(this,i);j(this,t)}});I.prototype.validateProperties=function(e,t){const r=new Set;for(let o=0;o<e.length;o++){this.validateProperty(e[o],e,t);r.add(M(e[o]))}if(r.size!==e.length){y("Properties do not have unique keys.")}};I.prototype.validateProperty=function(e,t,r){if(!o(e)){y("Property info must be a plain object.")}S(this,e,t);if(I.isPropertyComplex(e)){if(!e.propertyInfos||e.propertyInfos.length===0){y("Complex property does not reference existing properties.",e)}}const i=u.get(this);i.aMandatoryAttributes.forEach(t=>{const r=i.mAttributeMetadata[t];const o=r.inComplexProperty.allowed;const n=p[t];const a=n&&n in e;const l=a?e[n]==null:e[t]==null;if(l&&I.isPropertyComplex(e)&&!o){return}if(!(t in e||a)){c("Property does not contain mandatory attribute '"+t+"'.",e)}else if(l){y("Property does not contain mandatory attribute '"+t+"'.",e)}})};function S(e,t,r,o,i,n){const a=o==null;if(a){n=u.get(e).mAttributeMetadata;i=t}for(const l in i){let s=n[l];const u=a?l:o+"."+l;const f=i[l];if(!s){s=n[Object.entries(p).find(e=>e[1]===l)?.[0]]}if(!s){c("Property contains invalid attribute '"+u+"'.",t)}else if(I.isPropertyComplex(t)&&!s.inComplexProperty.allowed){c("Complex property contains invalid attribute '"+u+"'.",t)}else if(typeof s.type==="object"&&f&&typeof f==="object"){S(e,t,r,u,f,s.type)}else if(f!=null&&!g(s.type).isValid(f)){y("The value of '"+u+"' is invalid.",t)}else if(f&&typeof s.type==="string"&&s.type.startsWith("PropertyReference")){T(e,t,r,u,f,s)}}}function T(e,t,r,o,i,n){const a=n.type.endsWith("[]")?i:[i];const p=new Set(a);if(a.indexOf(M(t))>-1){y("Property references itself in the '"+o+"' attribute.",t)}if(p.size!==a.length){y("Property contains duplicate names in the '"+o+"' attribute.",t)}for(let e=0;e<r.length;e++){if(p.has(M(r[e]))){if(I.isPropertyComplex(r[e])){y("Property references complex properties in the '"+o+"' attribute.",t)}p.delete(M(r[e]))}}if(p.size>0){y("Property references non-existing properties in the '"+o+"' attribute.",t)}}I.prototype.prepareProperty=function(e){const t=this.getPropertyMap();const r=v(this,e,t);r.forEach(r=>{const o=b(e,r.targetPath);if(o){let i=b(e,r.source);if(i==null){i=m(r.targetType)}o[r.targetAttribute]=i;if(typeof r.targetType==="string"&&r.targetType.startsWith("PropertyReference")){w(o,r.targetAttribute,t)}}})};I.prototype.getParent=function(){const e=u.get(this);return e?e.oParent:null};I.prototype.setProperties=function(e){j(this,e)};I.prototype.getProperties=function(){const e=u.get(this);return e?e.aProperties:[]};I.prototype.getPropertyMap=function(){const e=u.get(this);return e?e.mProperties:{}};I.prototype.getProperty=function(e){return this.getPropertyMap()[e]||null};I.prototype.hasProperty=function(e){return e in this.getPropertyMap()};I.isPropertyComplex=function(e){return e!=null&&typeof e==="object"?"propertyInfos"in e:false};I.prototype.getSortableProperties=function(){return this.getProperties().filter(e=>e.sortable)};I.prototype.getFilterableProperties=function(){return this.getProperties().filter(e=>e.filterable)};I.prototype.getVisibleProperties=function(){return this.getProperties().filter(e=>e.visible)};I.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments);u.delete(this)};I.prototype._getAttributeMetadata=function(){const e=u.get(this);return e?r({},e.mAttributeMetadata):null};return I});
//# sourceMappingURL=PropertyHelper.js.map