/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","./PanelRenderer","sap/ui/core/Lib","sap/ui/layout/VerticalLayout","sap/base/Log","sap/ui/layout/HorizontalLayout","sap/m/HBox","sap/m/VBox","sap/m/ImageContent","sap/m/Link","sap/m/Label","sap/m/Text","sap/m/Button","sap/m/FlexItemData","sap/ui/model/json/JSONModel","sap/ui/model/BindingMode","sap/ui/base/ManagedObjectObserver","sap/ui/mdc/p13n/subcontroller/LinkPanelController","sap/m/p13n/Engine","sap/ui/mdc/mixin/AdaptationMixin","sap/ui/mdc/link/PanelItem","sap/ui/core/CustomData","./Factory"],(t,e,n,i,o,a,r,s,l,c,p,u,g,m,d,h,f,y,P,I,b,k,v)=>{"use strict";const _=t.extend("sap.ui.mdc.link.Panel",{metadata:{library:"sap.ui.mdc",defaultAggregation:"items",properties:{enablePersonalization:{type:"boolean",defaultValue:true,invalidate:true},metadataHelperPath:{type:"string"},beforeNavigationCallback:{type:"function"},onNavigationCallback:{type:"function"}},aggregations:{items:{type:"sap.ui.mdc.link.PanelItem",multiple:true,singularName:"item"},additionalContent:{type:"sap.ui.core.Control",multiple:true},_content:{type:"sap.ui.layout.VerticalLayout",visibility:"hidden",multiple:false}},events:{beforeSelectionDialogOpen:{},afterSelectionDialogClose:{}}},renderer:e});_.prototype.init=function(){t.prototype.init.call(this);this._registerP13n();sap.ui.require([this.getMetadataHelperPath()||"sap/ui/mdc/Link"],t=>{this._oMetadataHelper=t});const e=new d({countAdditionalContent:0,countItemsWithIcon:0,countItemsWithoutIcon:0,runtimeItems:[]});e.setDefaultBindingMode(h.TwoWay);e.setSizeLimit(1e3);this.setModel(e,"$sapuimdclinkPanel");this._oObserver=new f(O.bind(this));this._oObserver.observe(this,{properties:["enablePersonalization"],aggregations:["items","additionalContent"]})};const C=n.getResourceBundleFor("sap.ui.mdc");_.prototype.applySettings=function(){this._createContent();t.prototype.applySettings.apply(this,arguments)};_.prototype.exit=function(t){if(this._oObserver){this._oObserver.disconnect();this._oObserver=null}if(this._oMetadataHelper){this._oMetadataHelper=null}};const A=0,w=1,L=2,M=3;_.prototype._registerP13n=function(){P.getInstance().register(this,{controller:{LinkItems:new y({control:this})}});I.call(_.prototype);P.getInstance().defaultProviderRegistry.attach(this,"Global")};_.prototype._createContent=function(){const t=[];t[A]=this._createAdditionalContentArea();t[w]=this._createSeparator();t[L]=this._createLinkArea();t[M]=this._createFooterArea();const e=new i({width:"100%",content:t});this.setAggregation("_content",e)};_.prototype._createAdditionalContentArea=function(){const t=new s({fitContainer:false,items:this.getAdditionalContent()});return t};_.prototype._createSeparator=function(){const t=new s({fitContainer:false,visible:{parts:[{path:"$sapuimdclinkPanel>/countAdditionalContent"},{path:"$sapuimdcLink>/metadata"}],formatter:function(t,e){return t>0&&e.length>0}}});t.addStyleClass("mdcbaseinfoPanelSeparator");t.setModel(this._getInternalModel(),"$sapuimdclinkPanel");t.setModel(this.getModel("$sapuimdcLink"),"$sapuimdcLink");return t};_.prototype._createLinkArea=function(){const t=new s({fitContainer:false,items:{path:"$sapuimdclinkPanel>/runtimeItems",templateShareable:false,factory:this._fnLinkItemFactory.bind(this)}});t.addStyleClass("mdcbaseinfoPanelSectionLinks");t.setModel(this._getInternalModel(),"$sapuimdclinkPanel");return t};_.prototype._fnLinkItemFactory=function(t,e){const n=new l({src:"{$sapuimdclinkPanel>icon}",visible:{path:"$sapuimdclinkPanel>icon",formatter:function(t){return!!t}}});const i=new c({text:"{$sapuimdclinkPanel>text}",href:"{$sapuimdclinkPanel>href}",target:"{$sapuimdclinkPanel>target}",visible:{path:"$sapuimdclinkPanel>href",formatter:function(t){return!!t}},press:this.onPressLink.bind(this),wrapping:true,customData:new k({key:"internalHref",value:"{$sapuimdclinkPanel>internalHref}"})});const o=new p({text:"{$sapuimdclinkPanel>text}",visible:{path:"$sapuimdclinkPanel>href",formatter:function(t){return!t}},wrapping:true});const g=new u({text:"{$sapuimdclinkPanel>description}",visible:{path:"$sapuimdclinkPanel>description",formatter:function(t){return!!t}},wrapping:true});const d=new s({items:[i,o,g]});const h=new r({layoutData:new m({styleClass:e.getProperty("description")?"mdcbaseinfoPanelItemsGroup":"mdcbaseinfoPanelItemsWithoutGroup"}),items:[n,d]});const f=new a({visible:"{$sapuimdclinkPanel>visible}",content:[h]});f.addStyleClass("mdcbaseinfoPanelListItem");return f};_.prototype._createFooterArea=function(){const t=new g(this.getId()+"--idSectionPersonalizationButton",{type:"Transparent",text:C.getText("info.POPOVER_DEFINE_LINKS"),press:this.onPressLinkPersonalization.bind(this)});const e=new r({visible:{path:"$sapuimdcLink>/metadata",formatter:function(t){return t.length>0}},justifyContent:"End",items:[t]});e.addStyleClass("mdcbaseinfoPanelPersonalizationButton");return e};_.prototype.onPressLink=function(t){const e=t.getSource();const n=t.getParameters().ctrlKey||t.getParameters().metaKey;if(this.getBeforeNavigationCallback()&&e&&e.getTarget()!=="_blank"&&!n){const n=e&&e.getCustomData()&&e.getCustomData()[0]&&e.getCustomData()[0].getValue();const i=n?e.getCustomData()[0].getValue():e.getHref();t.preventDefault();this.getBeforeNavigationCallback()(t).then(t=>{if(t){this._onNavigate(e);_.navigate(i)}})}else{this._onNavigate(e)}};_.prototype._onNavigate=function(t){if(this.getOnNavigationCallback()){this.getOnNavigationCallback()(t)}};_.oNavigationPromise=undefined;_.navigate=function(t){const e=v.getUShellContainer();if(t.indexOf("#")===0&&e){if(!_.oNavigationPromise){_.oNavigationPromise=v.getServiceAsync("Navigation").then(e=>{e.navigate({target:{shellHash:t.substring(1)}});_.oNavigationPromise=undefined})}}else{window.location.href=t}};_.prototype.onPressLinkPersonalization=function(){this._openPersonalizationDialog()};_.prototype._openPersonalizationDialog=function(){return new Promise(t=>{const e=this.getParent();if(e.isA("sap.m.Popover")){e.setModal(true)}P.getInstance().show(this,"LinkItems",{contentWidth:"28rem",contentHeight:"35rem",close:()=>{if(e.isA("sap.m.Popover")){e.setModal(false)}}}).then(n=>{n.attachAfterClose(()=>{if(e.isA("sap.m.Popover")){e.setModal(false)}});t(n)})})};_._getVisibleItems=function(t){return t.filter(t=>t.id!==undefined&&t.visible)};_.prototype._getInternalModel=function(){return this.getModel("$sapuimdclinkPanel")};_.prototype._propagateDefaultIcon=function(t){if(!t){return}const e=this._getInternalModel();e.getProperty("/runtimeItems").forEach((t,n)=>{if(t.icon){return}e.setProperty("/runtimeItems/"+n+"/icon","sap-icon://chain-link")})};let x,S,$,W,N;function O(t){const e=this._getInternalModel();if(t.object.isA("sap.ui.mdc.link.Panel")){switch(t.name){case"additionalContent":x=t.child?[t.child]:t.children;x.forEach(e=>{switch(t.mutation){case"insert":this._getAdditionalContentArea().addItem(e);break;case"remove":break;default:o.error("Mutation '"+t.mutation+"' is not supported yet.")}});e.setProperty("/countAdditionalContent",x.length);break;case"items":S=t.child?[t.child]:t.children;S.forEach(function(n){const i=e.getProperty("/runtimeItems/");switch(t.mutation){case"insert":e.setProperty("/countItemsWithIcon",n.getIcon()?e.getProperty("/countItemsWithIcon")+1:e.getProperty("/countItemsWithIcon"));e.setProperty("/countItemsWithoutIcon",n.getIcon()?e.getProperty("/countItemsWithoutIcon"):e.getProperty("/countItemsWithoutIcon")+1);i.splice(this.indexOfItem(n),0,n.getJson());e.setProperty("/runtimeItems",i);this._propagateDefaultIcon(e.getProperty("/countItemsWithIcon")>0&&e.getProperty("/countItemsWithoutIcon")>0);this._oObserver.observe(n,{properties:["visible"]});break;case"remove":e.setProperty("/countItemsWithIcon",n.getIcon()?e.getProperty("/countItemsWithIcon")-1:e.getProperty("/countItemsWithIcon"));e.setProperty("/countItemsWithoutIcon",n.getIcon()?e.getProperty("/countItemsWithoutIcon"):e.getProperty("/countItemsWithoutIcon")-1);$=i.find(t=>t.id===n.getId());i.splice(i.indexOf($),1);e.setProperty("/runtimeItems",i);this._propagateDefaultIcon(e.getProperty("/countItemsWithIcon")>0&&e.getProperty("/countItemsWithoutIcon")>0);this._oObserver.unobserve(n);n.destroy();this.invalidate();break;default:o.error("Mutation '"+t.mutation+"' is not supported yet.")}},this);break;case"enablePersonalization":this._getPersonalizationButton().setVisible(t.current);break;default:o.error("The property or aggregation '"+t.name+"' has not been registered.")}}else if(t.object.isA("sap.ui.mdc.link.PanelItem")){switch(t.name){case"visible":W=t.object;N=this.indexOfItem(W);if(W.getVisibleChangedByUser()){e.setProperty("/runtimeItems/"+N+"/visible",W.getVisible())}else{e.setProperty("/baselineItems/"+N+"/visible",W.getVisible());e.setProperty("/runtimeItems/"+N+"/visible",W.getVisible())}break;default:o.error("The '"+t.name+"' of PanelItem is not supported yet.")}}}_.prototype.getCurrentState=function(){const t=[];let e;this.getItems().forEach((n,i)=>{e=n&&n.getId();if(n.getVisible()){t.push({name:e})}});return{items:t}};_.prototype.initPropertyHelper=function(){const t=this._oMetadataHelper.retrieveAllMetadata(this);return Promise.resolve({getProperties:function(){const e=[];t.forEach(t=>{e.push({name:t.id,getName:function(){return t.id},getLabel:function(){return t.text},text:t.text,href:t.href,internalHref:t.internalHref,description:t.description,target:t.target,visible:t.visible})});return e}})};_.prototype._getAdditionalContentArea=function(){return this.getAggregation("_content").getContent()[A]};_.prototype._getSeparator=function(){return this.getAggregation("_content").getContent()[w]};_.prototype._getLinkArea=function(){return this.getAggregation("_content").getContent()[L]};_.prototype._getLinkControls=function(){return this._getLinkArea().getItems().map(t=>t.getContent()[0].getItems()[1].getItems()[0])};_.prototype._getFooterArea=function(){return this.getAggregation("_content").getContent()[M]};_.prototype._getPersonalizationButton=function(){return this._getFooterArea().getItems()[0]};return _});
//# sourceMappingURL=Panel.js.map