/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/mdc/valuehelp/base/ListContent","sap/ui/mdc/util/loadModules","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/OperatorName","sap/ui/mdc/enums/ValueHelpSelectionType","sap/ui/model/ParseException","sap/base/util/deepEqual"],(t,e,i,s,n,o,a,l)=>{"use strict";const r=e.extend("sap.ui.mdc.valuehelp.content.FixedList",{metadata:{library:"sap.ui.mdc",interfaces:["sap.ui.mdc.valuehelp.ITypeaheadContent","sap.ui.mdc.valuehelp.IDialogContent"],properties:{groupable:{type:"boolean",group:"Appearance",defaultValue:false},filterList:{type:"boolean",group:"Appearance",defaultValue:true}},aggregations:{items:{type:"sap.ui.mdc.valuehelp.content.FixedListItem",multiple:true,singularName:"item"}},defaultAggregation:"items",events:{}}});r.prototype.init=function(){e.prototype.init.apply(this,arguments);this._oResourceBundle=t.getResourceBundleFor("sap.ui.mdc");this._iNavigateIndex=-1};r.prototype.exit=function(){if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel}e.prototype.exit.apply(this,arguments)};r.prototype.getContent=function(){return this._retrievePromise("content",()=>i(["sap/m/List","sap/m/DisplayListItem","sap/m/library","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/base/ManagedObjectModel","sap/base/strings/whitespaceReplacer"]).then(t=>{const e=t[0];const i=t[1];const s=t[2];const n=t[3];const o=t[4];const a=t[5];const l=t[6];this._oManagedObjectModel=new a(this);const r=new i(this.getId()+"-item",{type:s.ListType.Active,label:{path:"$help>text",formatter:l},value:{path:"$help>additionalText",formatter:l},valueTextDirection:"{$help>textDirection}"}).addStyleClass("sapMComboBoxNonInteractiveItem");const c=new n({path:"text",test:d.bind(this),caseSensitive:true});let p;if(this.getGroupable()){p=new o("groupKey",false,f.bind(this))}const h=new e(this.getId()+"-List",{width:"100%",showNoData:false,mode:s.ListMode.SingleSelectMaster,rememberSelections:false,items:{path:"$help>/items",template:r,filters:c,sorter:p,templateShareable:false},itemPress:u.bind(this)}).addStyleClass("sapMComboBoxBaseList").addStyleClass("sapMComboBoxList");h.applyAriaRole("listbox");h.setModel(this._oManagedObjectModel,"$help");this.setAggregation("displayContent",h,true);m.call(this,true);return h}))};function c(){return this.getAggregation("displayContent")}function u(t){const e=t.getParameter("listItem");const i=e.getSelected();if(i){const t=I.call(this,e);const i=x.call(this,t);const s=S.call(this,t);p.call(this,i,s);this.fireSelect({type:o.Set,conditions:this.getConditions()});this.fireConfirm()}}function p(t,e){const i=this.createCondition(t,e);this.setProperty("conditions",[i],true);return i}function d(t){const e=this.getFilterList();return!e||h.call(this,t,this.getFilterValue())}function h(t,e){return!e||typeof e==="string"&&(this.getCaseSensitive()?t.startsWith(e):t.toLowerCase().startsWith(e.toLowerCase()))}function g(){if(this._iNavigateIndex>=0){this.setProperty("conditions",[],true);this._iNavigateIndex=-1}const t=c.call(this);const e=this.getListBinding();if(t){e.update();t.updateItems();t.invalidate();m.call(this,true)}}function f(t){const e=t.getProperty("groupKey");const i=t.getProperty("groupText");return{key:e,text:i}}function m(t){const e=c.call(this);if(e){const i=this.getConditions();let o,a;const l=this.getFilterValue();const r=this.getUseFirstMatch();let c=false;let u;let p;if(i.length>0&&(i[0].validated===s.Validated||i[0].operator===n.EQ)){o=i[0].values[0]}if(r&&l){const t=this.getValueHelpDelegate().getFirstMatch(this.getValueHelpInstance(),this,{checkDescription:true,value:l});p=this.getValueHelpDelegate().isFilteringCaseSensitive(this.getValueHelpInstance(),this);if(t){a=v.call(this,t)}}const d=e.getItems();d.forEach((t,e)=>{if(e===this._iNavigateIndex){t.addStyleClass("sapMLIBFocused")}else{t.removeStyleClass("sapMLIBFocused")}if(t.isA("sap.m.DisplayListItem")){const e=I.call(this,t);if(i.length>0&&x.call(this,e)===o){t.setSelected(true);t.addStyleClass("sapMLIBFocused")}else if(i.length===0&&this._iNavigateIndex<0&&!c&&a&&a===e){t.setSelected(true);t.addStyleClass("sapMLIBFocused");u=t.getId();c=true}else{t.setSelected(false)}}});if(t&&c){y.call(this,a,u,p)}}}function y(t,e,i){const s=this.getFilterValue();const n=this.getUseFirstMatch();if(n&&s&&t){const n=x.call(this,t);const o=S.call(this,t);const a=this.createCondition(n,o);this.fireTypeaheadSuggested({condition:a,filterValue:s,itemId:e,caseSensitive:i})}}function I(t){return this._oManagedObjectModel.getProperty(t.getBindingContextPath())}function v(t){return this._oManagedObjectModel.getProperty(t.getPath())}function x(t){const e=t.getBinding("key");if(e){return e.getInternalValue()}else{return t.getKey()}}function S(t){const e=t.getBinding("text");if(e){return e.getInternalValue()}else{return t.getText()}}r.prototype.getItemForValue=function(t){return this.getContent().then(()=>{if(t.value===null||t.value===undefined){return null}else if(!t.value&&t.checkDescription){return null}const e=this.getItems();let i;let s=0;let n;let o;for(s=0;s<e.length;s++){i=e[s];n=x.call(this,i);o=S.call(this,i);if(t.checkKey&&l(n,t.parsedValue)||t.checkDescription&&(l(o,t.parsedDescription)||i.getText()===t.value)){return{key:n,description:o}}}if(t.checkKey&&t.value===""){return null}if(this.getUseFirstMatch()){const e=this.getValueHelpDelegate().getFirstMatch(this.getValueHelpInstance(),this,t);if(e){const t=v.call(this,e);n=x.call(this,t);o=S.call(this,t);return{key:n,description:o}}}const r=this._oResourceBundle.getText("valuehelp.VALUE_NOT_EXIST",[t.value]);const c=t.exception||a;throw new c(r)})};r.prototype.isValidationSupported=function(t){return true};r.prototype.isSearchSupported=function(){return true};r.prototype.handleConditionsUpdate=function(t){m.call(this,false)};r.prototype.handleFilterValueUpdate=function(t){g.call(this);e.prototype.handleFilterValueUpdate.apply(this,arguments)};r.prototype.removeFocus=function(){const t=c.call(this);if(t){t.removeStyleClass("sapMListFocus")}};r.prototype.navigate=function(t){const e=c.call(this);if(!e){return}e.addStyleClass("sapMListFocus");const i=e.getItems();const s=i.length;const n=this._iNavigateIndex>=0?i[this._iNavigateIndex]:e.getSelectedItem();let o=0;const a=this.getFilterList();const l=this.getFilterValue();let r=false;const u=this.getParent().isOpen();if(!a&&!n){let e=0;if(t>=0){for(e=0;e<i.length;e++){if(!i[e].isA("sap.m.GroupHeaderListItem")&&h.call(this,i[e].getLabel(),l)){o=e;break}}}else{for(e=i.length-1;e>=0;e--){if(!i[e].isA("sap.m.GroupHeaderListItem")&&h.call(this,i[e].getLabel(),l)){o=e;break}}}}else if(n){o=e.indexOfItem(n);o=o+t}else if(t>=0){o=t-1}else{o=s+t}if(t===9999){o=s-1}if(t===-9999){o=0}let d;if(o<0){o=0;d=true;r=true}else if(o>=s-1){o=s-1;d=false}else{d=t>=0}const g=function(){while(i[o]&&i[o].isA("sap.m.GroupHeaderListItem")){if(d){o++}else{o--}}};if(!u){g();if(o<0||o>s-1){d=!d;r=o<0;o=o<0?0:s-1;g()}}const f=i[o];if(f){const t=this.getUseFirstMatch();if(f!==n||t&&!r){let t,i,s;this._iNavigateIndex=o;f.setSelected(true);if(u){e.scrollToIndex(o);f.$().trigger("focusin")}if(f.isA("sap.m.GroupHeaderListItem")){this.setProperty("conditions",[],true);this.fireNavigated({condition:undefined,itemId:f.getId(),leaveFocus:false})}else{t=I.call(this,f);i=x.call(this,t);s=S.call(this,t);const e=p.call(this,i,s);this.fireNavigated({condition:e,itemId:f.getId(),leaveFocus:false})}}else if(r){this.fireNavigated({condition:undefined,itemId:undefined,leaveFocus:r})}}};r.prototype.onShow=function(){e.prototype.onShow.apply(this,arguments);const t=c.call(this);let i;if(!t){return null}const s=t.getSelectedItem();if(s){const e=t.indexOfItem(s);t.scrollToIndex(e);i=s.getId();t.addStyleClass("sapMListFocus")}return i};r.prototype.onHide=function(){this.removeFocus();this._iNavigateIndex=-1};r.prototype.getValueHelpIcon=function(){if(this.getUseAsValueHelp()){return"sap-icon://slim-arrow-down"}else{return null}};r.prototype.getAriaAttributes=function(t){return{contentId:this.getId()+"-List",ariaHasPopup:"listbox",roleDescription:null,valueHelpEnabled:false,autocomplete:this.getUseFirstMatch()?"both":"none"}};r.prototype.shouldOpenOnClick=function(){return!this.getFilterList()};r.prototype.isFocusInHelp=function(){return false};r.prototype.isSingleSelect=function(t){return true};r.prototype.shouldOpenOnNavigate=function(){return!e.prototype.isSingleSelect.apply(this)};r.prototype.isNavigationEnabled=function(t){return this.getItems().length>0};r.prototype.onConnectionChange=function(){this._iNavigateIndex=-1};r.prototype.getListBinding=function(){const t=c.call(this);return t&&t.getBinding("items")};r.prototype.getRelevantContexts=function(t){return this.getListBinding().getCurrentContexts().filter(e=>{const i=t.checkDescription?e.getProperty("text"):e.getProperty("key");return h.call(this,i,t.value)})};return r});
//# sourceMappingURL=FixedList.js.map