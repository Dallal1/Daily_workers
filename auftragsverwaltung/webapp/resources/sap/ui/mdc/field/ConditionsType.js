/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Lib","sap/ui/mdc/field/ConditionType","sap/ui/mdc/field/ConditionTypeMixin","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/ConditionValidateException","sap/ui/mdc/condition/FilterOperatorUtil","sap/ui/mdc/enums/ConditionValidated","sap/ui/mdc/enums/OperatorName","sap/ui/model/SimpleType","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/base/util/merge","sap/ui/base/SyncPromise","sap/ui/core/util/PasteHelper"],(t,e,i,n,o,s,a,r,l,u,d,p,h,f,c)=>{"use strict";const y=l.extend("sap.ui.mdc.field.ConditionsType",{constructor:function(i,n){l.apply(this,arguments);this.sName="Conditions";i=g(i);this._oConditionType=new e(i,this.oConstraints);this._oResourceBundle=t.getResourceBundleFor("sap.ui.mdc")}});y.prototype.destroy=function(){l.prototype.destroy.apply(this,arguments);if(this._oConditionType){this._oConditionType.destroy();this._oConditionType=undefined}this._bDestroyed=true};y.prototype.setFormatOptions=function(t){l.prototype.setFormatOptions.apply(this,arguments);t=g(t);if(this._oConditionType){this._oConditionType.setFormatOptions(t)}};function g(t){t=h({},t);if(t.asyncParsing){delete t.asyncParsing}return t}y.prototype.setConstraints=function(t){l.prototype.setConstraints.apply(this,arguments);if(this._oConditionType){this._oConditionType.setConstraints(this.oConstraints)}};y.prototype.formatValue=function(t,e){if(t==undefined||t==null||this._bDestroyed){return null}if(!Array.isArray(t)){throw new u("No valid conditions provided")}let i;if(!e||e==="string"||e==="any"){i=""}else if(e==="float"||e==="int"){i=0}if(this._getNoFormatting()){return this._getKeepValue()||i}const n=this._getMaxConditions();const o=[];const s=function(t,e){return f.resolve().then(()=>this._oConditionType.formatValue(t,e))};for(let i=0;i<t.length;i++){o.push(s.call(this,t[i],e));if(n>0&&i>=n-1){break}}return f.all(o).then(t=>m.call(this,t,i)).unwrap()};function m(t,e){for(let i=0;i<t.length;i++){if(e){e=e+this._oResourceBundle.getText("field.SEPARATOR")+t[i]}else{e=t[i]}}return e}y.prototype.parseValue=function(t,e){if(this._bDestroyed){return null}if(this._getNoFormatting()&&t===""){return this.oFormatOptions.getConditions?this.oFormatOptions.getConditions():[]}return this._parseValueToIndex(t,e,-1)};y.prototype._parseValueToIndex=function(t,e,i){const n=this._getValueType();const o=this._getDefaultOperator(this._getOperators(),n);const s=o&&o.name===r.BT;const a=this._getMultipleLines();const l=a||e&&e!=="string"?[[t]]:c.getPastedDataAs2DArray(t);if(l.length>1||l.length===1&&l[0].length>1){const t=[{property:"value",type:n},{property:"additionalValue",type:s?n:this._getAdditionalValueType()}];const e=c.parse(l,t).then(t=>_.call(this,t,i,o,s));return this._fnReturnPromise(e)}else{return C.call(this,t,e,i)}};function C(t,e,i){const n=function(t,e){return this._oConditionType.parseValue(t,e)};const o=function(t){throw t};return v.call(this,[t],e,i,n,o)}function _(t,e,i,o){if(t.errors){if(t.errors.length===1){throw new d(t.errors[0].message)}else{throw new d(this._oResourceBundle.getText("field.PASTE_ERROR"))}}else{let s=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();for(let r=0;r<t.parsedData.length;r++){const l=t.parsedData[r];const u=n.createCondition(i.name,[l.value],undefined,undefined,a.NotValidated,undefined);if(o){u.values.push(l.additionalValue)}s=T.call(this,u,s,e,true);if(e>=0){e++}}return s}}function v(t,e,i,n,o){const s=[];for(let i=0;i<t.length;i++){s.push(n.call(this,t[i],e))}const a=f.all(s).then(t=>{let e=this.oFormatOptions.getConditions&&this.oFormatOptions.getConditions();for(let n=0;n<t.length;n++){e=T.call(this,t[n],e,i,false);if(i>=0){i++}}return e}).catch(t=>{o.call(this,t)}).unwrap();return this._fnReturnPromise(a)}function T(t,e,i,n){const o=this._isUnit(this.oFormatOptions.valueType);const a=this._getMaxConditions();if(a!==1&&this.oFormatOptions.getConditions){if(t){if(this._isCompositeType(this.oFormatOptions.valueType)&&!o&&e.length===1&&(e[0].values[0][0]===null||e[0].values[0][0]===undefined||e[0].values[0][1]===null||e[0].values[0][1]===undefined)&&(t.values[0][0]!==null&&t.values[0][0]!==undefined&&t.values[0][1]!==null&&t.values[0][1]!==undefined)){e.splice(0,1)}if(s.indexOfCondition(t,e)===-1){if(i>=0&&e.length>i){e.splice(i,0,t)}else{e.push(t)}}else if(!n){throw new d(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[t.values[0]]))}if(a>0&&a<e.length){e.splice(0,e.length-a)}}return e}else if(o&&this.oFormatOptions.getConditions&&e.length>1){const i=t&&t.values[0][1];const n=t&&t.inParameters;const o=t&&t.outParameters;const s=t&&t.payload;for(let a=0;a<e.length;a++){e[a].values[0][1]=i;if(i===undefined){e[a].values[0][0]=t.values[0][0]}e[a].values[0].splice(2);if(e[a].operator===r.BT){e[a].values[1][1]=i;if(i===undefined){e[a].values[1][0]=t.values[0][0]}e[a].values[1].splice(2)}if(n||e[a].inParameters){e[a].inParameters=n}if(o||e[a].outParameters){e[a].outParameters=o}if(s||e[a].payload){e[a].payload=s}}if(e.length===0){e.push(t)}return e}else if(t){return[t]}else{return[]}}y.prototype.validateValue=function(t){if(t===undefined||t===null||this._bDestroyed){return}if(!Array.isArray(t)){throw new o("No valid conditions provided",undefined,undefined,t)}let e;try{for(let i=0;i<t.length;i++){e=t[i];this._oConditionType.validateValue(e)}const i=this._getMaxConditions();if(t.length===0&&i===1){this._oConditionType.validateValue(null)}}catch(i){if(i instanceof o){i.setConditions(t)}else if(i instanceof p){throw new o(i.message,i.violatedConstraints,h({},e))}throw i}};i.call(y.prototype);return y});
//# sourceMappingURL=ConditionsType.js.map