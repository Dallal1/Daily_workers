/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./utils/TableUtils","./menus/ColumnHeaderMenuAdapter","sap/ui/core/Element","sap/ui/core/library","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/model/Type","sap/ui/model/type/String","sap/base/util/ObjectPath","sap/base/util/JSTokenizer","sap/base/Log"],function(e,t,r,i,a,n,o,l,s,u,p,f,g){"use strict";var d=i.HorizontalAlign;var h=i.SortOrder;var y=i.ValueState;var c={Standard:"Standard",Creation:"Creation"};var m=e.createWeakMapFacade();var b=new window.WeakMap;var v=r.extend("sap.ui.table.Column",{metadata:{library:"sap.ui.table",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},minWidth:{type:"int",group:"Dimension",defaultValue:0},flexible:{type:"boolean",group:"Behavior",defaultValue:true,deprecated:true},resizable:{type:"boolean",group:"Behavior",defaultValue:true},hAlign:{type:"sap.ui.core.HorizontalAlign",group:"Appearance",defaultValue:d.Begin},sorted:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},sortOrder:{type:"sap.ui.core.SortOrder",group:"Appearance",defaultValue:h.None},sortProperty:{type:"string",group:"Behavior",defaultValue:null},filtered:{type:"boolean",group:"Appearance",defaultValue:false},filterProperty:{type:"string",group:"Behavior",defaultValue:null},filterValue:{type:"string",group:"Behavior",defaultValue:null},filterOperator:{type:"string",group:"Behavior",defaultValue:null},defaultFilterOperator:{type:"string",group:"Behavior",defaultValue:null},filterType:{type:"any",group:"Misc",defaultValue:null},grouped:{type:"boolean",group:"Appearance",defaultValue:false,deprecated:true},visible:{type:"boolean",group:"Appearance",defaultValue:true},name:{type:"string",group:"Appearance",defaultValue:null},showFilterMenuEntry:{type:"boolean",group:"Appearance",defaultValue:true},showSortMenuEntry:{type:"boolean",group:"Appearance",defaultValue:true},headerSpan:{type:"any",group:"Behavior",defaultValue:1},autoResizable:{type:"boolean",group:"Behavior",defaultValue:false}},defaultAggregation:"label",aggregations:{label:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},multiLabels:{type:"sap.ui.core.Control",multiple:true,singularName:"multiLabel"},template:{type:"sap.ui.core.Control",altTypes:["string"],multiple:false},creationTemplate:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},menu:{type:"sap.ui.unified.Menu",multiple:false}},associations:{headerMenu:{type:"sap.ui.core.IColumnHeaderMenu",multiple:false}},events:{columnMenuOpen:{allowPreventDefault:true,parameters:{menu:{type:"sap.ui.unified.Menu"}}}}}});v._DEFAULT_FILTER_TYPE=new u;v.prototype.init=function(){this.mSkipPropagation={template:true,creationTemplate:true};m(this).oSorter=null;m(this).mCellContentVisibilitySettings=S(this);m(this).bHasDefaultLabel=false;m(this).bHasDefaultTemplate=false;this._initTemplateClonePool()};v.prototype._initTemplateClonePool=function(){this._mTemplateClones=Object.keys(c).reduce(function(e,t){e[t]=[];return e},{})};v.prototype.exit=function(){this._destroyTemplateClones();t.unlink(this)};v.prototype.invalidate=function(t){if(t!==this.getTemplate()&&t!==this.getCreationTemplate()&&!e.isA(t,"sap.ui.table.ColumnMenu")){r.prototype.invalidate.apply(this,arguments)}};v.prototype.setLabel=function(t){var r=t;if(typeof t==="string"){if(m(this).bHasDefaultLabel){this.getLabel().setText(t);return this}r=e._getTableTemplateHelper().createLabel({text:t});m(this).bHasDefaultLabel=true}else if(m(this).bHasDefaultLabel){this.destroyLabel();m(this).bHasDefaultLabel=false}if(r&&r.setIsInColumnHeaderContext){r.setIsInColumnHeaderContext(true)}var i=this.getLabel();if(i&&r!==i&&i.setIsInColumnHeaderContext){i.setIsInColumnHeaderContext(false)}return this.setAggregation("label",r)};v.prototype.setTemplate=function(t){var r=t;var i=this._getTable();var a=this.getTemplate();var n=true;if(typeof t==="string"){if(m(this).bHasDefaulTemplate){this.getTemplate().bindProperty("text",t);n=false}else{r=e._getTableTemplateHelper().createTextView().bindProperty("text",t);m(this).bHasDefaulTemplate=true}}else if(m(this).bHasDefaulTemplate){this.destroyTemplate();m(this).bHasDefaulTemplate=false}if(n){this.setAggregation("template",r,true)}if(this.getVisible()){this.invalidate()}this._destroyTemplateClones("Standard");if(i&&this.getVisible()){if(r){i.invalidateRowsAggregation()}if(!a||!r){var o=i.getCreationRow();if(o){o._update()}}}return this};v.prototype.destroyTemplate=function(){this.destroyAggregation("template");this._destroyTemplateClones("Standard");var e=this._getTable();var t=e?e.getCreationRow():null;if(t){t._update()}return this};v.prototype.setCreationTemplate=function(e){var t=this._getTable();this.setAggregation("creationTemplate",e,true);this._destroyTemplateClones("Creation");if(e&&t&&this.getVisible()){var r=t.getCreationRow();if(r){r._update()}}return this};v.prototype.getCreationTemplate=function(){return this.getAggregation("creationTemplate")};v.prototype.destroyCreationTemplate=function(){this.destroyAggregation("creationTemplate",true);this._destroyTemplateClones("Creation");return this};v.prototype._menuHasItems=function(){var t=this._getTable();var r=(t?t.getEnableColumnFreeze():false)||(t?t.getShowColumnVisibilityMenu():false)||this.isSortableByMenu()||this.isFilterableByMenu()||this.isGroupableByMenu();if(r){return true}return e.Hook.call(t,e.Hook.Keys.Column.MenuItemNotification,this).some(function(e){return e})};v.prototype.isFilterableByMenu=function(){return!!(this.getFilterProperty()&&this.getShowFilterMenuEntry())};v.prototype.isSortableByMenu=function(){return!!(this.getSortProperty()&&this.getShowSortMenuEntry())};v.prototype.isGroupableByMenu=function(){var e=this._getTable();return!!(e&&e.getEnableGrouping&&e.getEnableGrouping()&&this.getSortProperty())};v.prototype._isGroupableByMenu=function(){var e=false;e=this.isGroupableByMenu();return e};v.prototype.setSorted=function(e){if(e&&this.getSortOrder()===h.None&&!this.isBound("sortOrder")){this.setSortOrder(h.Ascending)}return this.setProperty("sorted",e)};v.prototype.setFilterValue=function(e){return this.setProperty("filterValue",e,true)};v.prototype.setFilterOperator=function(e){return this.setProperty("filterOperator",e,true)};v.prototype.setDefaultFilterOperator=function(e){return this.setProperty("defaultFilterOperator",e,true)};v.prototype._openHeaderMenu=function(e){var r=this.getHeaderMenuInstance();this._cellPressed=e;t.activateFor(this).then(function(){if(r){r.openBy(e)}})};v.prototype._isHeaderMenuOpen=function(){var e=this.getHeaderMenuInstance();if(e){return e.isOpen()}};v.prototype._setGrouped=function(e){var t=this._getTable();t.setGroupBy(e?this:null)};v.prototype._isAggregatableByMenu=function(){return false};v.prototype.toggleSort=function(){this.sort(this.getSorted()&&this.getSortOrder()===h.Ascending)};v.prototype.sort=function(e,t){this._sort(e?h.Descending:h.Ascending,t);return this};v.prototype._sort=function(e,t){var r=this._getTable();if(!r||this.getSortProperty()===""){return}var i=r.fireSort({column:this,sortOrder:e,columnAdded:e!==h.None&&t===true});if(!i){return}if(e===h.None){r._removeSortedColumn(this)}else{r.pushSortedColumn(this,t)}this.setSorted(e!==h.None);this.setSortOrder(e);this._updateSorters()};v.prototype._updateSorters=function(){var e=this._getTable();var t=e.getSortedColumns();var r=e.getColumns();var i=this.getSortOrder();for(let e=0,i=r.length;e<i;e++){if(t.indexOf(r[e])<0){r[e].resetProperty("sorted");r[e].resetProperty("sortOrder");delete m(r[e]).oSorter}}if(i!==h.None){m(this).oSorter=new l(this.getSortProperty(),i===h.Descending)}this._applySorters()};v.prototype._applySorters=function(){const e=this._getTable();const t=e.getBinding();if(!t){g.warning("Sorting not performed because no binding present",this);return}const r=e.getSortedColumns();const i=r.map(e=>m(e).oSorter);t.sort(i)};v.prototype._getFilterState=function(){try{this._getFilter();return y.None}catch(e){return y.Error}};v.prototype._getFilter=function(){var e,t=this.getFilterProperty(),r=this.getFilterValue(),i=this.getFilterOperator(),o,l,s=this.getFilterType()||v._DEFAULT_FILTER_TYPE,p=s instanceof u,f;if(r){if(!i){f=r.match(/(.*)\s*\.\.\s*(.*)/);if(r.indexOf("=")==0){i=n.EQ;o=r.substr(1)}else if(r.indexOf("!=")==0){i=n.NE;o=r.substr(2)}else if(r.indexOf("<=")==0){i=n.LE;o=r.substr(2)}else if(r.indexOf("<")==0){i=n.LT;o=r.substr(1)}else if(r.indexOf(">=")==0){i=n.GE;o=r.substr(2)}else if(r.indexOf(">")==0){i=n.GT;o=r.substr(1)}else if(f){if(f[1]&&f[2]){i=n.BT;o=f[1];l=f[2]}else if(f[1]&&!f[2]){i=n.GE;o=f[1]}else{i=n.LE;o=f[2]}}else if(p&&r.indexOf("*")==0&&r.lastIndexOf("*")==r.length-1){i=n.Contains;o=r.substr(1,r.length-2)}else if(p&&r.indexOf("*")==0){i=n.EndsWith;o=r.substr(1)}else if(p&&r.lastIndexOf("*")==r.length-1){i=n.StartsWith;o=r.substr(0,r.length-1)}else{if(this.getDefaultFilterOperator()){i=this.getDefaultFilterOperator()}else if(p){i=n.Contains}else{i=n.EQ}o=r.substr(0)}if(!l){e=new a(t,i,this._parseFilterValue(o))}else{e=new a(t,i,this._parseFilterValue(o),this._parseFilterValue(l))}}else{e=new a(t,i,this._parseFilterValue(r))}}return e};v.prototype.filter=function(t){var r=this._getTable();if(!r?.getBinding()||this.getFilterProperty()===""){return}var i=r.fireFilter({column:this,value:t});if(!i){return}var a=[];var n=r.getColumns();this.setFiltered(!!t);this.setFilterValue(t);for(var l=0,s=n.length;l<s;l++){var u=n[l],p,f;try{p=u._getFilter();f=y.None}catch(e){f=y.Error}if(p){a.push(p)}e.Hook.call(this._getTable(),e.Hook.Keys.Column.SetFilterState,u,f)}r.getBinding().filter(a,o.Control)};v.prototype._parseFilterValue=function(e){var t=this.getFilterType();if(t){if(typeof t==="function"){e=t(e)}else{e=t.parseValue(e,"string")}}return e};v.prototype.shouldRender=function(){var e=this.getVisible()&&this.getTemplate()!=null;e=e&&!this.getGrouped();return e};v.prototype.setProperty=function(e,t){var i=this._getTable();var a=i&&this.getProperty(e)!=t;var n=a&&e==="visible";var o=a&&(e==="visible"||e==="headerSpan");var l=r.prototype.setProperty.apply(this,arguments);if(n){i.invalidateRowsAggregation();var s=i.getCreationRow();if(s){s._update()}}if(o){i._invalidateComputedFixedColumnCount()}return l};v.prototype.setFilterType=function(e){var t=e;if(typeof e==="string"){try{var r=f.parseJS(e);if(typeof r.type==="string"){var i=sap.ui.require(r.type.replaceAll(".","/"));if(!i){i=p.get(e)}t=i&&new i(r.formatOptions,r.constraints)}}catch(r){var i=sap.ui.require(e.replaceAll(".","/"));if(!i){i=p.get(e)}t=i&&new i}if(!(t instanceof s)){g.error("The filter type is not an instance of sap.ui.model.Type! Ignoring the filter type!");t=undefined}}this.setProperty("filterType",t,true);return this};v.prototype.getIndex=function(){var e=this._getTable();if(e){return e.indexOfColumn(this)}else{return-1}};v.prototype.isDragAllowed=function(t){return e.Column.isColumnMovable(this,true)};v.prototype._getFreeTemplateClone=function(e){var t=this._mTemplateClones[e];var r=null;if(!t){return null}for(var i=0;i<t.length;i++){if(!t[i]||t[i].bIsDestroyed){t.splice(i,1);i--}else if(!r&&!t[i].getParent()){r=t[i]}}return r};v.prototype.getTemplateClone=function(e,t){if(typeof e!=="number"||this.getTemplate()==null){return null}var r=t==null?"Standard":t;var i=this._getFreeTemplateClone(r);if(!i&&c.hasOwnProperty(r)){var a=this["get"+(r==="Standard"?"":r)+"Template"];var n=a.call(this);if(n){i=n.clone();this._mTemplateClones[r].push(i)}}if(i){b.set(i,this);var o=this._getTable();if(o){o._getAccExtension().addColumnHeaderLabel(this,i)}}return i};function T(e){for(var t=0;t<e.length;t++){if(e[t]!=null&&!e[t].bIsDestroyed){e[t].destroy()}}}v.prototype._destroyTemplateClones=function(e){if(e==null){for(var t in c){T(this._mTemplateClones[t])}this._initTemplateClonePool()}else{T(this._mTemplateClones[e]);this._mTemplateClones[e]=[]}};v.prototype._getTable=function(){var t=this.getParent();return e.isA(t,"sap.ui.table.Table")?t:null};v.prototype._setCellContentVisibilitySettings=function(e){C(e);m(this).mCellContentVisibilitySettings=S(this,e)};v.prototype._getCellContentVisibilitySettings=function(){return m(this).mCellContentVisibilitySettings};v.prototype.getHeaderMenuInstance=function(){return r.getElementById(this.getHeaderMenu())};function C(e){if(e==null){return}_(e,null,false,["standard","groupHeader","summary"]);_(e.standard,"standard",true);_(e.groupHeader,"groupHeader",true,["nonExpandable","expanded","collapsed"]);_(e.summary,"summary",true,["group","total"])}function _(e,t,r,i){if(e!=null&&!(r&&typeof e==="boolean"||i&&typeof e==="object")){throw new Error("Invalid value"+(t?" for '"+t+"'":""))}if(i&&e!=null&&typeof e==="object"){Object.keys(e).forEach(function(r){if(i.includes(r)){if(t!=null){_(e[r],t+"."+r,true)}}else{throw new Error("Unsupported setting '"+(t?t+".":"")+r+"'")}})}}function S(e,t){t=t?t:{};return{standard:F(t.standard),groupHeader:{nonExpandable:F(t.groupHeader,"nonExpandable"),expanded:F(t.groupHeader,"expanded"),collapsed:F(t.groupHeader,"collapsed")},summary:{group:F(t.summary,"group"),total:F(t.summary,"total")}}}function F(e,t){if(typeof e==="boolean"){return e}else if(t&&e){return e[t]!==false}else{return true}}v.ofCell=function(e){return b.get(e)||null};return v});
//# sourceMappingURL=Column.js.map