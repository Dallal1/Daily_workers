/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Lib","sap/ui/fl/apply/_internal/changes/descriptor/Applier","sap/ui/fl/apply/_internal/changes/descriptor/ApplyStrategyFactory","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/variants/VariantModel","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/model/json/JSONModel","sap/ui/performance/Measurement"],function(e,t,n,o,a,r,i,s,l,p,c,u,d,f){"use strict";var m={};m._componentInstantiationPromises=new WeakMap;var g={};function h(n){if(u.getUshellContainer()){return Promise.resolve()}var o=window.sessionStorage.getItem(`sap.ui.rta.restart.${c.CUSTOMER}`);if(o){var a=i.getFlexReferenceForControl(n);if(o!==a&&o!=="true"){e.error(`an application component was started which does not match the component for which the restart was triggered:\n\t\t\t\t\tTriggering component: ${o}\n\t\t\t\t\tStarted component: ${a}`);return Promise.resolve()}return new Promise(function(e,o){Promise.all([t.load({name:"sap.ui.rta"}),n.rootControlLoaded()]).then(function(){sap.ui.require(["sap/ui/rta/api/startKeyUserAdaptation"],function(t){t({rootControl:n});e()})}).catch(function(e){o(e)})})}return Promise.resolve()}function C(e){const t=i.getFlexReferenceForControl(e);const n=r.getStorageResponse(t);if(n.messagebundle&&!e.getModel("i18nFlexVendor")&&n.changes?.changes?.some(e=>e.layer===c.VENDOR)){e.setModel(new d(n.messagebundle),"i18nFlexVendor")}}async function y(e){var t=p.createForControl(e);const n=i.getFlexReferenceForControl(e);var o;var r=a.applyAllChangesForControl.bind(a,e,n);r._bIsSapUiFlFlexControllerApplyChangesOnControl=true;e.addPropagationListener(r);o=m._createVariantModel(t,e);await o.initialize();f.end("flexProcessing");e.setModel(o,s.getVariantModelName());await h(e)}function M(e,t){if(u.isApplicationComponent(e)){var n=e.getId();r.rebuildFilteredResponse(i.getFlexReferenceForControl(e));var o=r.initialize({componentId:n,asyncHints:t.asyncHints}).then(y.bind(this,e)).then(C.bind(this,e)).then(function(){if(g[n]){g[n].forEach(function(t){var n=e.getModel(s.getVariantModelName());t.setModel(n,s.getVariantModelName())});delete g[n]}});m._componentInstantiationPromises.set(e,o);return o}else if(u.isEmbeddedComponent(e)){var a=u.getAppComponentForControl(e);if(m._componentInstantiationPromises.has(a)){return m._componentInstantiationPromises.get(a).then(function(){var t=a.getModel(s.getVariantModelName());e.setModel(t,s.getVariantModelName())})}g[a.getId()]=g[a.getId()]||[];g[a.getId()].push(e);return Promise.resolve()}return Promise.resolve()}function F(e,t){if(!u.isApplication(t)||!e.id){return Promise.resolve()}r.initialize({componentData:e.componentData||e.settings&&e.settings.componentData,asyncHints:e.asyncHints,manifest:t,componentId:e.id});return n.applyChangesIncludedInManifest(t,o.getRuntimeStrategy())}m._createVariantModel=function(e,t){return new l({},{flexController:e,appComponent:t})};m.instanceCreatedHook=function(...e){return M(...e)};m.componentLoadedHook=function(...e){return F(...e)};return m});
//# sourceMappingURL=ComponentLifecycleHooks.js.map