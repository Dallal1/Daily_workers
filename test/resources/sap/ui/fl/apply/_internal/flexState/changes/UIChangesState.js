/*
 * ! OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/includes","sap/base/util/merge","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/apply/_internal/changes/Utils","sap/ui/fl/apply/_internal/flexState/changes/DependencyHandler","sap/ui/fl/apply/_internal/flexState/controlVariants/VariantManagementState","sap/ui/fl/apply/_internal/flexState/DataSelector","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils"],(e,n,t,c,a,s,i,p,r)=>{"use strict";const l="sap.ui.fl.apply._internal.flexObjects.UIChange";const o={};function d(e,n){const t=o.getCompleteDependencyMap(n).mDependencies;return t[e.getId()]&&Object.assign({},t[e.getId()])}function u(n,c,a,s,i){const p=[];const r=o.getLiveDependencyMap(i);const l=Object.assign({},n);n.controlsDependencies.forEach(function(n){if(!t.bySelector(n,a)){const c=t.getControlIdBySelector(n,a);p.push(n);r.mControlsWithDependencies[c]||=[];if(!e(r.mControlsWithDependencies[c],s.getId())){r.mControlsWithDependencies[c].push(s.getId())}}});l.dependencies=c;l.controlsDependencies=p;if(c.length||p.length){r.mDependencies[s.getId()]=l}return l}const f=new i({id:"allUIChanges",parentDataSelector:p.getFlexObjectsDataSelector(),executeFunction(e){return e.filter(e=>e.isA(l))},checkInvalidation(e,n){const t=["addFlexObject","removeFlexObject"].includes(n.type);return t&&n.updatedObject?.isA(l)}});const g=new i({id:"vmIndependentUIChanges",parentDataSelector:f,executeFunction(e){return e.filter(e=>!e.getVariantReference())},checkInvalidation(e,n){const t=["addFlexObject","removeFlexObject"].includes(n.type);return t&&n.updatedObject?.isA(l)&&!n.updatedObject.getVariantReference()&&!n.updatedObject.getSelector().persistencyKey}});const D=new i({id:"vmIndependentCompleteDependencyMap",parentDataSelector:g,executeFunction(e,n){const t=a.createEmptyDependencyMap();const c=p.getComponentIdForReference(n.reference);e.forEach(e=>{a.addChangeAndUpdateDependencies(e,c,t)});return t}});o.getCompleteDependencyMap=function(e){const t=D.get({reference:e});const c=s.getDependencyMap(e);const a=n({},t);n(a.mDependencies,c.mDependencies);n(a.mDependentChangesOnMe,c.mDependentChangesOnMe);a.aChanges=a.aChanges.concat(c.aChanges);["mChanges","mControlsWithDependencies"].forEach(e=>{Object.entries(c[e]).forEach(([n,t])=>{if(Object.keys(a[e]).includes(n)){a[e][n]=a[e][n].concat(t)}else{a[e][n]=t}})});return a};o.getLiveDependencyMap=function(e){return p.getRuntimeOnlyData(e).liveDependencyMap||a.createEmptyDependencyMap()};o.copyDependenciesFromCompleteDependencyMap=function(e,n){const a=r.getFlexReferenceForControl(n);let s=d(e,a);if(s){const i=o.getLiveDependencyMap(a);const p=[];s.dependencies.forEach(function(a){if(c.checkIfDependencyIsStillValid(n,t,i,a)){i.mDependentChangesOnMe[a]||=[];i.mDependentChangesOnMe[a].push(e.getId());p.push(a)}});s=u(s,p,n,e,a)}};o.getAllUIChanges=function(e){return f.get({reference:e})};return o});
//# sourceMappingURL=UIChangesState.js.map