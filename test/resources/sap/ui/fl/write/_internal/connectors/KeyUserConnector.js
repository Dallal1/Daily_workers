/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/Lib","sap/ui/fl/Layer","sap/ui/fl/write/_internal/connectors/BackendConnector","sap/ui/fl/initial/_internal/connectors/KeyUserConnector","sap/ui/fl/initial/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/base/util/restricted/_pick","sap/ui/fl/initial/_internal/FlexInfoSession","sap/ui/core/BusyIndicator","sap/base/Log","sap/m/MessageBox"],function(e,n,t,r,s,a,i,o,u,S,l,E){"use strict";var R="/flex/keyuser";var T=e({},r,{layers:[t.CUSTOMER,t.PUBLIC],ROUTES:{CHANGES:`${R+s.API_VERSION}/changes/`,SETTINGS:`${R+s.API_VERSION}/settings`,TOKEN:`${R+s.API_VERSION}/settings`,VERSIONS:{GET:`${R+s.API_VERSION}/versions/`,ACTIVATE:`${R+s.API_VERSION}/versions/activate/`,DISCARD:`${R+s.API_VERSION}/versions/draft/`,PUBLISH:`${R+s.API_VERSION}/versions/publish/`},TRANSLATION:{UPLOAD:`${R+s.API_VERSION}/translation/texts`,DOWNLOAD:`${R+s.API_VERSION}/translation/texts/`,GET_SOURCELANGUAGE:`${R+s.API_VERSION}/translation/sourcelanguages/`},CONTEXTS:`${R+s.API_VERSION}/contexts/`},isLanguageInfoRequired:true,getContexts(e){var n=["type","$skip","$filter"];var t=o(e,n);var r=a.getUrl(T.ROUTES.CONTEXTS,e,t);return a.sendRequest(r,"GET",{initialConnector:s}).then(function(e){return e.response})},loadContextDescriptions(e){var n={};a.addLanguageInfo(n);c(e);var t=a.getUrl(T.ROUTES.CONTEXTS,e,n);e.payload=JSON.stringify(e.flexObjects);e.dataType="json";e.contentType="application/json; charset=utf-8";return i.sendRequest(t,"POST",e).then(function(e){return e.response})},isContextSharingEnabled(){return Promise.resolve(true)},getFlexInfo(e){return u.getByReference(e.reference)}});function c(e){e.initialConnector=s;e.tokenUrl=T.ROUTES.TOKEN}function O(e){var n={title:e.title};e.payload=JSON.stringify(n);e.dataType="json";e.contentType="application/json; charset=utf-8"}function g(e){e.version=e.versionNumber.toString();delete e.versionNumber;return e}T.versions={load(e){c(e);var n={};a.addLanguageInfo(n);n.limit=e.limit;var t=a.getUrl(T.ROUTES.VERSIONS.GET,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e.response.versions.map(function(e){return g(e)})})},activate(e){c(e);O(e);var n={version:e.version};a.addLanguageInfo(n);var t=a.getUrl(T.ROUTES.VERSIONS.ACTIVATE,e,n);return i.sendRequest(t,"POST",e).then(function(e){var n=e.response;return g(n)})},discardDraft(e){c(e);var n=a.getUrl(T.ROUTES.VERSIONS.DISCARD,e);return i.sendRequest(n,"DELETE",e)},publish(e){var t=n.getResourceBundleFor("sap.ui.fl");var r=function(n){S.hide();var r=t.getText("MSG_CF_PUBLISH_ERROR",n?[n.message||n]:undefined);var s=t.getText("HEADER_TRANSPORT_ERROR");l.error(`publish version error${n}`);E.show(r,{icon:E.Icon.ERROR,title:s,styleClass:e.styleClass});return"Error"};c(e);var s={version:e.version};var o=a.getUrl(T.ROUTES.VERSIONS.PUBLISH,e,s);return i.sendRequest(o,"POST",e).then(function(){S.hide();return t.getText("MSG_CF_PUBLISH_SUCCESS")}).catch(r)}};T.translation={getTexts(e){c(e);var n=o(e,["sourceLanguage","targetLanguage"]);var t=a.getUrl(T.ROUTES.TRANSLATION.DOWNLOAD,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e.response})},getSourceLanguages(e){c(e);var n={};var t=a.getUrl(T.ROUTES.TRANSLATION.GET_SOURCELANGUAGE,e,n);return a.sendRequest(t,"GET",e).then(function(e){return e&&e.response&&e.response.sourceLanguages?e.response.sourceLanguages:[]})},postTranslationTexts(e){c(e);var n=a.getUrl(T.ROUTES.TRANSLATION.UPLOAD,e,{});return a.sendRequest(n,"POST",e)}};T.initialConnector=s;return T});
//# sourceMappingURL=KeyUserConnector.js.map