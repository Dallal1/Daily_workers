/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./_GroupingUtils","./_ColumnUtils","./_MenuUtils","./_BindingUtils","./_HookUtils","../library","sap/ui/base/Object","sap/ui/core/Element","sap/ui/core/ResizeHandler","sap/ui/core/library","sap/ui/core/theming/Parameters","sap/ui/core/Theming","sap/ui/core/Icon","sap/ui/core/Lib","sap/ui/model/ChangeReason","sap/ui/thirdparty/jquery","sap/base/util/restricted/_throttle","sap/base/Log"],function(e,t,n,i,a,o,r,l,s,u,d,c,f,g,p,jQuery,C,v){"use strict";var m=o.SelectionBehavior;var R=o.SelectionMode;var _=u.MessageType;var h;var w=null;var b={DATACELL:1<<1,COLUMNHEADER:1<<2,ROWHEADER:1<<3,ROWACTION:1<<4,COLUMNROWHEADER:1<<5,PSEUDO:1<<6};b.ANYCONTENTCELL=b.ROWHEADER|b.DATACELL|b.ROWACTION;b.ANYCOLUMNHEADER=b.COLUMNHEADER|b.COLUMNROWHEADER;b.ANYROWHEADER=b.ROWHEADER|b.COLUMNROWHEADER;b.ANY=b.ANYCONTENTCELL|b.ANYCOLUMNHEADER;var I={sapUiSizeCozy:48,sapUiSizeCompact:32,sapUiSizeCondensed:24,undefined:32};var S=1;var T=1;var E={sapUiSizeCozy:I.sapUiSizeCozy+T,sapUiSizeCompact:I.sapUiSizeCompact+T,sapUiSizeCondensed:I.sapUiSizeCondensed+T,undefined:I.undefined+T};var y={navigationIcon:"navigation-right-arrow",deleteIcon:"sys-cancel",clearSelectionIcon:"clear-all",navIndicatorWidth:3};var x={Render:"Render",VerticalScroll:"VerticalScroll",FirstVisibleRowChange:"FirstVisibleRowChange",Unbind:"Unbind",Animation:"Animation",Resize:"Resize",Zoom:"Zoom",Unknown:"Unknown"};for(var A in p){x[A]=p[A]}var U=":sapTabbable, .sapUiTableTreeIcon:not(.sapUiTableTreeIconLeaf)";var L={Grouping:e,Column:t,Menu:n,Binding:i,Hook:a,CELLTYPE:b,BaseSize:I,BaseBorderWidth:S,RowHorizontalFrameSize:T,DefaultRowHeight:E,RowsUpdateReason:x,INTERACTIVE_ELEMENT_SELECTORS:U,ThemeParameters:y,hasRowHeader:function(t){return t.getSelectionMode()!==R.None&&t.getSelectionBehavior()!==m.RowOnly||e.isInGroupMode(t)},hasSelectAll:function(e){var t=e?e.getSelectionMode():R.None;return t===R.MultiToggle&&e.getEnableSelectAll()},hasRowHighlights:function(e){if(!e){return false}var t=e.getRowSettingsTemplate();if(!t){return false}var n=t.getHighlight();return t.isBound("highlight")||n!=null&&n!==_.None},hasRowNavigationIndicators:function(e){if(!e){return false}var t=e.getRowSettingsTemplate();if(!t){return false}var n=t.getNavigated();return t.isBound("navigated")||n},hasRowActions:function(e){var t=e?e.getRowActionTemplate():null;return t!=null&&(t.isBound("visible")||t.getVisible())&&e.getRowActionCount()>0},isRowSelectionAllowed:function(e){return e.getSelectionMode()!==R.None&&(e.getSelectionBehavior()===m.Row||e.getSelectionBehavior()===m.RowOnly)},isRowSelectorSelectionAllowed:function(e){return e.getSelectionMode()!==R.None&&L.hasRowHeader(e)},isNoDataVisible:function(e){return!e._isNoDataDisabled()&&!L.hasData(e)||L.getVisibleColumnCount(e)===0},hasData:function(e){return e._getTotalRowCount()>0},isBusyIndicatorVisible:function(e){if(!e||!e.getDomRef()){return false}return e.getDomRef().querySelector('[id="'+e.getId()+'-sapUiTableGridCnt"] > .sapUiLocalBusyIndicator')!=null},isA:function(e,t){return r.isObjectA(e,t)},toggleRowSelection:function(e,t,n,i){var a;if(L.isA(t,"sap.ui.table.Row")){a=t}else if(typeof t==="number"){a=e.getRows()[t]}else{var o=jQuery(t);var r=L.getCellInfo(o[0]);var l=L.isRowSelectionAllowed(e);if(!L.Grouping.isInGroupHeaderRow(o[0])&&(r.isOfType(L.CELLTYPE.DATACELL|L.CELLTYPE.ROWACTION)&&l||r.isOfType(L.CELLTYPE.ROWHEADER)&&L.isRowSelectorSelectionAllowed(e))){a=e.getRows()[r.rowIndex]}}if(!a||a.isEmpty()){return}e._iSourceRowIndex=a.getIndex();if(i){i(a)}else{var s=e._getSelectionPlugin();s.setSelected(a,typeof n==="boolean"?n:!s.isSelected(a))}delete e._iSourceRowIndex},getNoContentMessage:function(e){if(L.getVisibleColumnCount(e)>0){return e.getNoData()||L.getResourceText("TBL_NO_DATA")}else{return e.getAggregation("_noColumnsMessage")||L.getResourceText("TBL_NO_COLUMNS")}},getVisibleColumnCount:function(e){return e._getVisibleColumns().length},getHeaderRowCount:function(e){if(e._iHeaderRowCount===undefined){if(!e.getColumnHeaderVisible()){e._iHeaderRowCount=0}else{var t=1;var n=e.getColumns();for(var i=0;i<n.length;i++){if(n[i].shouldRender()){t=Math.max(t,n[i].getMultiLabels().length)}}e._iHeaderRowCount=t}}return e._iHeaderRowCount},isVariableRowHeightEnabled:function(e){var t=e._getRowCounts();return e&&e._bVariableRowHeightEnabled&&!t.fixedTop&&!t.fixedBottom},getNonEmptyRowCount:function(e){return Math.min(e._getRowCounts().count,e._getTotalRowCount())},getFocusedItemInfo:function(e){var t=e._getItemNavigation();if(!t){return null}return{cell:t.getFocusedIndex(),columnCount:t.iColumns,cellInRow:t.getFocusedIndex()%t.iColumns,row:Math.floor(t.getFocusedIndex()/t.iColumns),cellCount:t.getItemDomRefs().length,domRef:t.getFocusedDomRef()}},getRowIndexOfFocusedCell:function(e){var t=L.getFocusedItemInfo(e);return t.row-L.getHeaderRowCount(e)},isFixedColumn:function(e,t){return t<e.getComputedFixedColumnCount()},hasFixedColumns:function(e){return e.getComputedFixedColumnCount()>0},focusItem:function(e,t,n){var i=e._getItemNavigation();if(i){i.focusItem(t,n)}},scrollTableToIndex:function(e,t,n){if(!e){return Promise.resolve()}var i=e.getFirstVisibleRow();var a=e._getRowCounts();var o=i+a.scrollable-1;var r=false;if(t<i||t>o){var l=n?t-a.fixedTop-1:t-a.scrollable-a.fixedTop+2;r=e._setFirstVisibleRowIndex(Math.max(0,l))}return new Promise(function(t){if(r){e.attachEventOnce("_rowsUpdated",t)}else{t()}})},showNotificationPopoverAtIndex:function(e,t,n){var i=e._oNotificationPopover;var a=e.getRows()[t-e._getFirstRenderedRowIndex()];var o=L.getResourceText("TBL_SELECT_LIMIT_TITLE");var r=L.getResourceText("TBL_SELECT_LIMIT",[n]);return new Promise(function(t){sap.ui.require(["sap/m/Popover","sap/m/Bar","sap/m/Title","sap/m/Text","sap/m/HBox","sap/ui/core/library","sap/m/library"],function(n,l,s,u,d,c,g){if(!i){i=new n(e.getId()+"-notificationPopover",{customHeader:[new l({contentMiddle:[new d({items:[new f({src:"sap-icon://message-warning",color:c.IconColor.Critical}).addStyleClass("sapUiTinyMarginEnd"),new s({text:o,level:c.TitleLevel.H2})],renderType:g.FlexRendertype.Bare,justifyContent:g.FlexJustifyContent.Center,alignItems:g.FlexAlignItems.Center})]})],content:new u({text:r})});i.addStyleClass("sapUiContentPadding");e._oNotificationPopover=i;e.addAggregation("_hiddenDependents",e._oNotificationPopover)}else{i.getContent()[0].setText(r)}e.detachFirstVisibleRowChanged(this.onFirstVisibleRowChange,this);e.attachFirstVisibleRowChanged(this.onFirstVisibleRowChange,this);var p=a.getDomRefs().rowSelector;if(p){i.attachEventOnce("afterOpen",t);i.openBy(p)}else{t()}}.bind(this))}.bind(this))},onFirstVisibleRowChange:function(e){var t=e.getSource();if(!t._oNotificationPopover){return}if(t){t.detachFirstVisibleRowChanged(this.onFirstVisibleRowChange,this)}t._oNotificationPopover.close()},loadContexts:function(e,t,n){var i=e.getContexts(t,n,0,true);var a=i.length===Math.min(n,e.getLength())&&!i.includes(undefined);if(a){return Promise.resolve(i)}return new Promise(function(i){e.attachEventOnce("dataReceived",function(){i(this.loadContexts(e,t,n))}.bind(this))}.bind(this))},getCellInfo:function(e){var t;var n=jQuery(e);var i;var a;var o;var r;var s;t={type:0,cell:null,rowIndex:null,columnIndex:null,columnSpan:null};if(n.hasClass("sapUiTableDataCell")){i=n.attr("data-sap-ui-colid");a=l.getElementById(i);t.type=L.CELLTYPE.DATACELL;t.rowIndex=parseInt(n.parent().attr("data-sap-ui-rowindex"));t.columnIndex=a.getIndex();t.columnSpan=1}else if(n.hasClass("sapUiTableHeaderDataCell")){o=/_([\d]+)/;i=n.attr("id");r=o.exec(i);s=r&&r[1]!=null?parseInt(r[1]):0;t.type=L.CELLTYPE.COLUMNHEADER;t.rowIndex=s;t.columnIndex=parseInt(n.attr("data-sap-ui-colindex"));t.columnSpan=parseInt(n.attr("colspan")||1)}else if(n.hasClass("sapUiTableRowSelectionCell")){t.type=L.CELLTYPE.ROWHEADER;t.rowIndex=parseInt(n.parent().attr("data-sap-ui-rowindex"));t.columnIndex=-1;t.columnSpan=1}else if(n.hasClass("sapUiTableRowActionCell")){t.type=L.CELLTYPE.ROWACTION;t.rowIndex=parseInt(n.parent().attr("data-sap-ui-rowindex"));t.columnIndex=-2;t.columnSpan=1}else if(n.hasClass("sapUiTableRowSelectionHeaderCell")){t.type=L.CELLTYPE.COLUMNROWHEADER;t.columnIndex=-1;t.columnSpan=1}else if(n.hasClass("sapUiTablePseudoCell")){i=n.attr("data-sap-ui-colid");a=l.getElementById(i);t.type=L.CELLTYPE.PSEUDO;t.rowIndex=-1;t.columnIndex=a?a.getIndex():-1;t.columnSpan=1}if(t.type!==0){t.cell=n[0]}t.isOfType=function(e){if(e==null){return false}return(this.type&e)>0};return t},getRowColCell:function(e,t,n,i){var a=e.getRows()[t]||null;var o=i?e.getColumns():e._getVisibleColumns();var r=o[n]||null;var l;var s=null;if(a&&r){if(!l){var u=r.getMetadata();while(u.getName()!=="sap.ui.table.Column"){u=u.getParent()}l=u.getClass()}s=a.getCells().find(function(e){return r===l.ofCell(e)})||null}return{row:a,column:r,cell:s}},getCell:function(e,t,n){n=n===true;if(!e||!t){return null}var i=jQuery(t);var a=e.getDomRef();var o=".sapUiTableCell";if(!n){o+=":not(.sapUiTablePseudoCell)"}var r=i.closest(o,a);if(r.length>0){return r}return null},getParentCell:function(e,t,n){n=n===true;var i=jQuery(t);var a=L.getCell(e,t,n);if(!a||a[0]===i[0]){return null}else{return a}},registerResizeHandler:function(e,t,n,i,a){i=i==null?"":i;a=a===true;if(!e||typeof t!=="string"||typeof n!=="function"){return undefined}var o=e.getDomRef(i);L.deregisterResizeHandler(e,t);if(!e._mResizeHandlerIds){e._mResizeHandlerIds={}}if(a&&o){o=o.parentNode}if(o){e._mResizeHandlerIds[t]=s.register(o,n)}return e._mResizeHandlerIds[t]},deregisterResizeHandler:function(e,t){var n=[];if(!e._mResizeHandlerIds){return}if(typeof t==="string"){n.push(t)}else if(t===undefined){for(var i in e._mResizeHandlerIds){if(typeof i=="string"&&e._mResizeHandlerIds.hasOwnProperty(i)){n.push(i)}}}else if(Array.isArray(t)){n=t}for(var a=0;a<n.length;a++){var o=n[a];if(e._mResizeHandlerIds[o]){s.deregister(e._mResizeHandlerIds[o]);e._mResizeHandlerIds[o]=undefined}}},isFirstScrollableRow:function(e,t){if(isNaN(t)){var n=jQuery(t);t=parseInt(n.add(n.parent()).filter("[data-sap-ui-rowindex]").attr("data-sap-ui-rowindex"))}return t==e._getRowCounts().fixedTop},isLastScrollableRow:function(e,t){if(isNaN(t)){var n=jQuery(t);t=parseInt(n.add(n.parent()).filter("[data-sap-ui-rowindex]").attr("data-sap-ui-rowindex"))}var i=e._getRowCounts();return t==i.count-i.fixedBottom-1},getContentDensity:function(e){var t;var n=["sapUiSizeCondensed","sapUiSizeCompact","sapUiSizeCozy"];var i=function(e,t){if(!t[e]){return}for(var i=0;i<n.length;i++){if(t[e](n[i])){return n[i]}}};var a=e.$();if(a.length>0){t=i("hasClass",a)}else{t=i("hasStyleClass",e)}if(t){return t}var o=null;var r=e.getParent();if(r){do{t=i("hasStyleClass",r);if(t){return t}if(r.getDomRef){o=r.getDomRef()}else if(r.getRootNode){o=r.getRootNode()}if(!o&&r.getParent){r=r.getParent()}else{r=null}}while(r&&!o)}a=jQuery(o||document.body);t=i("hasClass",a.closest("."+n.join(",.")));return t},isVariableWidth:function(e){return!e||e=="auto"||e.toString().match(/%$/)},getFirstFixedBottomRowIndex:function(e){var t=e._getRowCounts();if(!e.getBinding()||t.fixedBottom===0){return-1}var n=-1;var i=e.getFirstVisibleRow();var a=e._getTotalRowCount();if(a>=t.count){n=t.count-t.fixedBottom}else{var o=a-t.fixedBottom-i;if(o>=0&&i+o<a){n=o}}return n},getResourceBundle:function(e){e=jQuery.extend({async:false,reload:false},e);if(h&&e.reload!==true){if(e.async===true){return Promise.resolve(h)}else{return h}}var t=g.getResourceBundleFor("sap.ui.table");h=t;if(e.async===true){t=Promise.resolve(h)}return t},getResourceText:function(e,t){return h?h.getText(e,t):""},dynamicCall:function(e,t,n){var i=typeof e==="function"?e():e;if(!i||!t){return undefined}n=n||i;if(typeof t==="function"){t.call(n,i);return undefined}else{var a;var o=[];for(var r in t){if(typeof i[r]==="function"){a=t[r];o.push(i[r].apply(n,a))}else{o.push(undefined)}}if(o.length===1){return o[0]}else{return o}}},throttle:function(e,t,n){n=Object.assign({leading:true,asyncLeading:false,trailing:true},n);var i;var a=false;var o={};var r;var l;if(n.leading&&n.asyncLeading){r=function(){if(a){var t=Promise.resolve().then(function(){if(!t.canceled){e.apply(o.context,o.args)}i=null});t.cancel=function(){t.canceled=true};i=t}else{e.apply(this,arguments)}}}else{r=e}var s=C(r,t,{leading:n.leading,trailing:n.trailing});if(n.leading&&n.asyncLeading){var u=s.cancel;s.cancel=function(){if(i){i.cancel()}u()};l=Object.assign(function(){o={context:this,args:arguments};a=true;s.apply(this,arguments);a=false},s)}else{l=s}return l},throttleFrameWise:function(e){var t=null;var n=function(){n.cancel();t=window.requestAnimationFrame(function(t){e.apply(this,t)}.bind(this,arguments))};n.cancel=function(){window.cancelAnimationFrame(t);t=null};return n},getInteractiveElements:function(e){if(!e){return null}var t=jQuery(e);var n=L.getCellInfo(t);if(n.isOfType(b.ANY|b.PSEUDO)){var i=t.find(U);if(i.length>0){return i}}return null},getFirstInteractiveElement:function(e,t){if(!e){return null}var n=e.getTable();var i=e.getCells();if(t===true&&L.hasRowActions(n)){i.push(e.getRowAction())}for(var a=0;a<i.length;a++){var o=i[a].getDomRef();var r=L.getCell(n,o,true);var l=L.getInteractiveElements(r);if(l){return l[0]}}return null},convertCSSSizeToPixel:function(e,t){var n;if(typeof e!=="string"){return null}if(e.endsWith("px")){n=parseFloat(e)}else if(e.endsWith("em")||e.endsWith("rem")){n=parseFloat(e)*L.getBaseFontSize()}else{return null}if(t){return n+"px"}else{return n}},getBaseFontSize:function(){if(w==null){var e=document.documentElement;if(e){w=parseInt(window.getComputedStyle(e).fontSize)}}return w==null?16:w},readThemeParameters:function(){var e=d.get({name:["_sap_ui_table_BaseSize","_sap_ui_table_BaseSizeCozy","_sap_ui_table_BaseSizeCompact","_sap_ui_table_BaseSizeCondensed","_sap_ui_table_BaseBorderWidth","_sap_ui_table_NavigationIcon","_sap_ui_table_DeleteIcon","_sap_ui_table_ClearSelectionIcon","_sap_ui_table_NavIndicatorWidth"]});function t(t){return L.convertCSSSizeToPixel(e[t])}I.undefined=t("_sap_ui_table_BaseSize");I.sapUiSizeCozy=t("_sap_ui_table_BaseSizeCozy");I.sapUiSizeCompact=t("_sap_ui_table_BaseSizeCompact");I.sapUiSizeCondensed=t("_sap_ui_table_BaseSizeCondensed");S=t("_sap_ui_table_BaseBorderWidth");T=S;E.undefined=I.undefined+T;E.sapUiSizeCozy=I.sapUiSizeCozy+T;E.sapUiSizeCompact=I.sapUiSizeCompact+T;E.sapUiSizeCondensed=I.sapUiSizeCondensed+T;y.navigationIcon=e["_sap_ui_table_NavigationIcon"];y.deleteIcon=e["_sap_ui_table_DeleteIcon"];y.clearSelectionIcon=e["_sap_ui_table_ClearSelectionIcon"];y.navIndicatorWidth=t("_sap_ui_table_NavIndicatorWidth")},isThemeApplied:function(){var e=false;var t=function(){e=true};c.attachApplied(t);c.detachApplied(t);return e},addDelegate:function(e,t,n){if(e&&t){e.addDelegate(t,false,n?n:t,false)}},removeDelegate:function(e,t){if(e&&t){e.removeDelegate(t)}},createWeakMapFacade:function(){var e=new window.WeakMap;return function(t){if(!t||!(typeof t==="object")){return null}if(!e.has(t)){e.set(t,{})}return e.get(t)}},_getTableTemplateHelper:function(e){var t="An automatic control and template generation for the sap.ui.table.Table is not supported "+"anymore for the aggragations footer and title and the aggregations label and template of "+"the sap.ui.table.Columns. Use concrete controls for those aggregations instead of altType string.";if(o.TableHelper){if(!e){v.warning(t)}return o.TableHelper}throw new Error(t)}};e.TableUtils=L;t.TableUtils=L;n.TableUtils=L;i.TableUtils=L;a.TableUtils=L;return L},true);
//# sourceMappingURL=TableUtils.js.map