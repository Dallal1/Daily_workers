/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/rta/plugin/Plugin","sap/ui/rta/Utils","sap/ui/dt/Util","sap/base/Log"],function(e,t,n,r){"use strict";var a=e.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",properties:{commandStack:{type:"any"}},associations:{},events:{}}});var i="CTX_SETTINGS";a.prototype._isEditable=function(e){var t=this.getAction(e);if(t){if(t.handler){return this.hasStableId(e)}var n=Object.keys(t).some(function(n){var r=t[n];return r.handler&&this._checkRelevantContainerStableID(r,e)}.bind(this));if(n){return this.hasStableId(e)}}return false};a.prototype.isEnabled=function(e){const t=e[0];const n=this.getResponsibleElementOverlay(t);const r=this.getAction(n);if(!r){return false}if(typeof r.isEnabled!=="undefined"){if(typeof r.isEnabled==="function"){return r.isEnabled(n.getElement())}return r.isEnabled}return true};a.prototype._getUnsavedChanges=function(e,t){var n;var r=this.getCommandStack().getAllExecutedCommands().filter(function(r){n=r.getElementId&&r.getElementId()||r.getElement&&r.getElement().getId();return n===e&&t.indexOf(r.getChangeType())>=0}).map(function(e){return e.getPreparedChange()});return r};a.prototype._handleFlexChangeCommand=function(e,t,n,r){var a=e.changeSpecificData;var i;var o=e.selectorElement||e.selectorControl;var s;var d;if(o.controlType){s=o.controlType}else{d=o}return this.hasChangeHandler(a.changeType,d,s).then(function(e){if(t[0].getVariantManagement&&e&&!r.CAUTION_variantIndependent){i=t[0].getVariantManagement()}return this.getCommandFactory().getCommandFor(o,"settings",a,undefined,i)}.bind(this)).then(function(e){var t=r.runtimeOnly;if(e&&t){e.setRuntimeOnly(t)}return n.addCommand(e)})};a.prototype._handleAppDescriptorChangeCommand=function(e,t,n){var r=e.changeSpecificData;var a=e.appComponent;var i=a.getManifest();var o=i["sap.app"].id;return this.getCommandFactory().getCommandFor(t,"appDescriptor",{reference:o,appComponent:a,changeType:r.appDescriptorChangeType,parameters:r.content.parameters,texts:r.content.texts}).then(function(e){return n.addCommand(e)})};a.prototype._handleCompositeCommand=function(e,t,n,r){var a;return this.getCommandFactory().getCommandFor(t,"composite").then(function(e){a=e}).then(function(){return n.map(function(n){var i=n.changeSpecificData;if(i.changeType){return this._handleFlexChangeCommand(n,e,a,r)}else if(i.appDescriptorChangeType){return this._handleAppDescriptorChangeCommand(n,t,a)}return undefined},this)}.bind(this)).then(function(e){return Promise.all(e)}).then(function(){if(a.getCommands().length>0){this.fireElementModified({command:a})}}.bind(this))};a.prototype.handler=function(e,r,a){r||={};var i=e[0].getElement();var{fnHandler:o}=r;o||=e[0].getDesignTimeMetadata().getAction("settings").handler;if(!o){throw new Error("Handler not found for settings action")}r.getUnsavedChanges=this._getUnsavedChanges.bind(this);r.styleClass=t.getRtaStyleClassName();return o(i,r).then(function(t){if(t.length>0){return this._handleCompositeCommand(e,i,t,a)}return undefined}.bind(this)).catch(function(e){throw n.propagateError(e,"Settings#handler","Error occurred during handler execution","sap.ui.rta.plugin")})};a.prototype.getMenuItems=function(e){const t=e[0];const n=this.getResponsibleElementOverlay(t);let a=this.getAction(n);const d=[];if(a){const e=110;if(a.handler){a={settings:a}}const t=Object.keys(a);t.forEach(function(t,c,u){const l=a[t];if(l.handler&&this._checkRelevantContainerStableID(l,n)&&this.isAvailable([n])){const t=u.length===1;d.push({id:t?i:i+c,rank:t?e:e+c,text:this.getActionText(n,l,i),icon:s(l),enabled:typeof l.isEnabled==="function"&&function(e){return l.isEnabled(e[0].getElement())}||l.isEnabled||this.isEnabled([n]),handler:function(e,t,n){n||={};n.fnHandler=e;return this.handler(t,n,l)}.bind(this,l.handler),submenu:o(l.submenu)})}else{r.warning(`Handler not found for settings action '${t}' or relevant container has no stable id`)}},this)}return d};function o(e){if(e){return e.map(function(e,t){return{id:e.key||`${i}_SUB_${t}`,icon:e.icon||"blank",text:e.name||"",enabled:e.hasOwnProperty("enabled")?e.enabled:true}})}return undefined}function s(e){var t="sap-icon://key-user-settings";var n=e.icon;if(!n){return t}if(typeof n!=="string"){r.error("Icon setting for settingsAction should be a string");return t}return n}a.prototype.getActionName=function(){return"settings"};return a});
//# sourceMappingURL=Settings.js.map